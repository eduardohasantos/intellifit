{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IntelliFit - Editar Treino</title>
    <link rel="stylesheet" href="{% static 'global/css/global.css' %}">
    <link rel="stylesheet" href="{% static 'workout/css/edit_workout.css' %}">
</head>
<body>
    <!-- Header EXATAMENTE IGUAL ao dashboard -->
    <header class="header">
        <a href="{% url 'dashboard' %}" class="logo-container">
            <h1 class="site-name">IntelliFit</h1>
        </a>
        
        <nav class="header-actions">
            <a href="{% url 'edit_account' %}" class="nav-btn"><i data-feather="user"></i> Editar Perfil</a>
            <a href="{% url 'delete_account' %}" class="nav-btn delete-btn"><i data-feather="trash-2"></i> Excluir Perfil</a>
            <form action="{% url 'logout' %}" method="post" class="logout-form">
                {% csrf_token %}
                <button type="submit" class="nav-btn logout-btn"><i data-feather="log-out"></i> Sair</button>
            </form>
        </nav>
    </header>

    <main class="main-content">
        <!-- Card principal CENTRALIZADO igual ao workout -->
        <div class="dashboard-container">
            <!-- Mensagens do Django -->
            {% if messages %}
                {% for message in messages %}
                    <div class="success-popup">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}

            <div class="welcome-section">
                <h2 class="welcome">Editar Treino</h2>
                <p class="welcome-subtitle">Atualize as informações do treino "{{ workout.name }}"</p>
            </div>

            <form method="post" class="edit-workout-form">
                {% csrf_token %}
                
                <div class="form-section">
                    <h3 class="section-title">Informações do Treino</h3>
                    
                    <div class="form-group">
                        <label for="id_name">Nome do treino</label>
                        <input type="text" name="name" id="id_name" class="form-input" value="{{ workout.name }}" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="id_description">Descrição</label>
                        <textarea name="description" id="id_description" class="form-input" rows="3">{{ workout.description }}</textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title">Exercícios</h3>
                    
                    {% if exercises %}
                        <div class="exercises-list">
                            {% for ex in exercises %}
                                <div class="exercise-item">
                                    <div class="exercise-header">
                                        <h4 class="exercise-name">{{ ex.exercise.name }}</h4>
                                        <button type="submit" name="remove_exercise" value="{{ ex.id }}" class="remove-btn" title="Remover exercício">
                                            <i data-feather="trash-2"></i>
                                        </button>
                                    </div>
                                    <div class="exercise-fields">
                                        <div class="field-group">
                                            <label for="sets_{{ ex.id }}">Séries</label>
                                            <input type="number" name="sets_{{ ex.id }}" id="sets_{{ ex.id }}" value="{{ ex.sets }}" min="1" class="number-input">
                                        </div>
                                        <div class="field-group">
                                            <label for="reps_{{ ex.id }}">Repetições</label>
                                            <input type="number" name="reps_{{ ex.id }}" id="reps_{{ ex.id }}" value="{{ ex.reps }}" min="1" class="number-input">
                                        </div>
                                        <div class="field-group">
                                            <label for="rest_time_{{ ex.id }}">Descanso (seg)</label>
                                            <input type="number" name="rest_time_{{ ex.id }}" id="rest_time_{{ ex.id }}" value="{{ ex.rest_time }}" min="0" class="number-input">
                                        </div>
                                    </div>
                                    <input type="hidden" name="order" value="{{ ex.id }}">
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="empty-exercises">
                            <i data-feather="alert-circle"></i>
                            <p>Nenhum exercício cadastrado neste treino.</p>
                        </div>
                    {% endif %}

                    <!-- Adicionar novo exercício -->
                    <div class="add-exercise-section">
                        <button type="button" id="toggle-add-exercise" class="toggle-btn">
                            <i data-feather="plus"></i> Adicionar Novo Exercício
                        </button>
                        
                        <div id="add-exercise-form" class="add-exercise-form">
                            <h4>Novo Exercício</h4>
                            <div class="form-group">
                                <label for="id_exercise_name">Nome do exercício</label>
                                <input type="text" name="exercise_name" id="id_exercise_name" class="form-input" 
                                       placeholder="Digite o nome do exercício" list="exercise-list" autocomplete="off">
                                <datalist id="exercise-list">
                                    {% for name in exercise_names %}
                                        <option value="{{ name }}">
                                    {% endfor %}
                                </datalist>
                            </div>
                            <div class="exercise-fields">
                                <div class="field-group">
                                    <label for="id_sets">Séries</label>
                                    <input type="number" name="sets" id="id_sets" value="3" min="1" class="number-input">
                                </div>
                                <div class="field-group">
                                    <label for="id_reps">Repetições</label>
                                    <input type="number" name="reps" id="id_reps" value="10" min="1" class="number-input">
                                </div>
                                <div class="field-group">
                                    <label for="id_rest_time">Descanso (seg)</label>
                                    <input type="number" name="rest_time" id="id_rest_time" value="60" min="0" class="number-input">
                                </div>
                            </div>
                            <button type="submit" name="add_exercise" value="1" class="add-btn">Adicionar Exercício</button>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <a href="{% url 'workout_detail' workout.id %}" class="cancel-btn">Cancelar</a>
                    <button type="submit" name="save_workout" value="1" class="submit-btn">Salvar Alterações</button>
                </div>
            </form>
        </div>
    </main>

    <script src="https://unpkg.com/feather-icons"></script>
    <script>
        feather.replace();
        
        // Toggle do formulário de adicionar exercício
        document.addEventListener('DOMContentLoaded', function() {
            const toggleBtn = document.getElementById('toggle-add-exercise');
            const addForm = document.getElementById('add-exercise-form');
            
            if (toggleBtn && addForm) {
                toggleBtn.addEventListener('click', function() {
                    addForm.style.display = addForm.style.display === 'none' ? 'block' : 'none';
                    toggleBtn.querySelector('i').setAttribute('data-feather', 
                        addForm.style.display === 'none' ? 'plus' : 'minus');
                    feather.replace();
                });
                
                // Inicia fechado
                addForm.style.display = 'none';
            }
            
            // Desabilitar resize da textarea
            const textarea = document.getElementById('id_description');
            if (textarea) {
                textarea.style.resize = 'none';
            }
        });
    </script>
</body>
</html>